<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Mega Monopoly 5 - Stock</title>
    <link rel="icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <h1 id="stockTicker">Stock</h1>
    <p><a href="/" id="backLink">Back</a></p>

    <p>Welcome, <strong id="u">?</strong></p>
    <p>It is <strong id="t">-</strong></p>
    <p>Balance: <strong id="bal">-</strong></p>

    <script>
      const params = new URLSearchParams(location.search);
      const username = params.get("username") || "";
      const stock = params.get("stock") || "";

      document.getElementById("u").textContent = username || "?";
      document.getElementById("stockTicker").textContent = stock || "Stock";

      const back = document.getElementById("backLink");
      back.href = username ? `/dashboard.html?username=${encodeURIComponent(username)}` : "/";

      async function loadUser() {
        if (!username) return;

        const r = await fetch(`/user?username=${encodeURIComponent(username)}`);
        const j = await r.json();

        if (j.ok) {
          document.getElementById("bal").textContent = j.balance;
          document.getElementById("t").textContent = j.time_string;
        } else {
          document.getElementById("bal").textContent = "unknown";
          document.getElementById("t").textContent = "-";
        }
      }

      loadUser();
      setInterval(loadUser, 2000);
    </script>
  </body>
</html>
